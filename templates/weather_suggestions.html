{% extends 'base.html' %}
{% block title %}Weather Tips{% endblock %}
{% block page_title %}ğŸŒ¤ï¸ Weather-Based Farm Suggestions{% endblock %}
{% block page_subtitle %}Smart farming advice based on current weather conditions{% endblock %}
{% block extra_head %}
<style>
.weather-hero{border-radius:20px;padding:30px;color:#fff;position:relative;overflow:hidden;}
{% if weather.rain_chance > 60 %}
.weather-hero{background:linear-gradient(135deg,#1e3a5f,#1d4ed8);}
{% elif weather.temp > 35 %}
.weather-hero{background:linear-gradient(135deg,#92400e,#b45309);}
{% else %}
.weather-hero{background:linear-gradient(135deg,#1a3209,#2d5016);}
{% endif %}
.weather-hero::after{content:'{{ "ğŸŒ§ï¸" if weather.rain_chance > 60 else "â˜€ï¸" if weather.temp > 35 else "ğŸŒ¤ï¸" }}';position:absolute;right:24px;top:50%;transform:translateY(-50%);font-size:7rem;opacity:.12;}
.weather-stat{background:rgba(255,255,255,.15);border-radius:12px;padding:14px;text-align:center;}
.weather-stat .val{font-family:'Lora',serif;font-size:1.8rem;font-weight:700;}
.weather-stat .lbl{font-size:.72rem;opacity:.75;text-transform:uppercase;letter-spacing:.8px;margin-top:2px;}
.tip-card{border-radius:14px;border:2px solid var(--cream-dark);background:#fff;padding:16px 18px;margin-bottom:10px;border-left:5px solid;}
.crop-section{background:var(--cream);border-radius:16px;padding:20px;margin-bottom:16px;}
.crop-section-header{font-family:'Lora',serif;font-weight:700;color:var(--green-dark);font-size:1rem;margin-bottom:12px;}
.general-tip{background:var(--cream-dark);border-radius:10px;padding:10px 14px;margin-bottom:8px;font-size:.87rem;color:var(--text-dark);}
.live-indicator{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,.15);padding:5px 14px;border-radius:20px;font-size:.75rem;font-weight:700;}
</style>
{% endblock %}
{% block content %}

<!-- Weather Hero Card -->
<div class="weather-hero mb-4">
  <div class="row align-items-center">
    <div class="col-sm-7">
      <div class="live-indicator mb-3">
        <span style="width:8px;height:8px;border-radius:50%;background:#4ade80;display:inline-block;animation:pulse 1.5s infinite;"></span>
        Smart Seasonal Data Â· {{ weather.month_name }}
      </div>
      <h3 style="font-family:'Lora',serif;color:#d4edba;margin-bottom:4px;">
        {{ weather.season }} Season Conditions
      </h3>
      <p style="opacity:.75;font-size:.9rem;">
        {% if weather.rain_chance > 60 %}
        ğŸŒ§ï¸ Rain likely today â€” adjust your farm activities accordingly
        {% elif weather.temp > 35 %}
        ğŸŒ¡ï¸ Very hot weather â€” protect your crops from heat stress
        {% elif weather.humidity > 80 %}
        ğŸŒ«ï¸ High humidity â€” watch for fungal diseases
        {% else %}
        âœ… Generally favorable conditions for farming activities
        {% endif %}
      </p>
    </div>
    <div class="col-sm-5 mt-3 mt-sm-0">
      <div class="row g-2">
        <div class="col-6">
          <div class="weather-stat">
            <div class="val">{{ weather.temp }}Â°C</div>
            <div class="lbl">Temperature</div>
          </div>
        </div>
        <div class="col-6">
          <div class="weather-stat">
            <div class="val">{{ weather.humidity }}%</div>
            <div class="lbl">Humidity</div>
          </div>
        </div>
        <div class="col-6">
          <div class="weather-stat">
            <div class="val">{{ weather.rain_chance }}%</div>
            <div class="lbl">Rain Chance</div>
          </div>
        </div>
        <div class="col-6">
          <div class="weather-stat">
            <div class="val">{{ weather.wind }} km/h</div>
            <div class="lbl">Wind Speed</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- General Tips -->
{% if general_tips %}
<div class="card mb-4">
  <div class="card-header"><i class="bi bi-lightning-charge-fill text-warning"></i> General Farm Alerts for Today</div>
  <div class="card-body">
    {% for tip in general_tips %}
    <div class="general-tip">{{ tip }}</div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Per Crop Suggestions -->
{% if suggestions %}
<h5 style="font-family:'Lora',serif;color:var(--green-dark);margin-bottom:14px;">
  ğŸŒ± Advice for Your Growing Crops
</h5>
{% for s in suggestions %}
<div class="crop-section">
  <div class="crop-section-header d-flex align-items-center justify-content-between flex-wrap gap-2">
    <span>ğŸŒ¿ {{ s.crop.name }}
      {% if s.crop.variety %}<small style="font-weight:400;color:var(--text-muted);font-size:.82rem;">({{ s.crop.variety }})</small>{% endif %}
    </span>
    <div class="d-flex gap-2 align-items-center flex-wrap">
      <span style="font-size:.75rem;background:var(--green-pale);color:var(--green-dark);padding:3px 10px;border-radius:20px;font-weight:700;">{{ s.stage }}</span>
      <span style="font-size:.72rem;color:var(--text-muted);">Day {{ s.days }} since sowing</span>
      {% if s.crop.expected_harvest %}
      <span style="font-size:.72rem;color:var(--text-muted);">Â· Harvest: {{ s.crop.expected_harvest.strftime('%d %b') }}</span>
      {% endif %}
    </div>
  </div>
  {% for tip in s.tips %}
  <div class="tip-card" style="border-left-color:{{ tip.color }}">
    <div style="font-weight:700;color:{{ tip.color }};font-size:.95rem;">{{ tip.icon }} {{ tip.title }}</div>
    <div style="font-size:.84rem;color:var(--text-mid);margin-top:5px;">{{ tip.msg }}</div>
  </div>
  {% endfor %}
</div>
{% endfor %}
{% else %}
<div class="card text-center py-4 mb-4">
  <div style="font-size:3rem;">ğŸŒ±</div>
  <h5 class="mt-3">No growing crops tracked</h5>
  <p class="text-muted">Add crops with "Growing" status to get personalized weather advice.</p>
  <a href="{{ url_for('crop_add') }}" class="btn btn-farm mt-2">Add a Crop</a>
</div>
{% endif %}

<!-- Season Activity Tips -->
<div class="card">
  <div class="card-header"><i class="bi bi-calendar3 text-success"></i> {{ weather.season }} Season â€” Key Activities</div>
  <div class="card-body">
    {% if weather.season == 'Monsoon' %}
    <div class="row g-3">
      {% for item in [
        ('ğŸŒ¾','Kharif Sowing','June-July is the ideal window for sowing kharif crops like rice, cotton, soyabean, and maize with monsoon moisture.'),
        ('ğŸŒ§ï¸','Drainage Management','Ensure proper drainage in all fields to prevent waterlogging which damages root systems.'),
        ('ğŸ„','Disease Watch','High humidity during monsoon increases fungal disease risk. Scout crops weekly.'),
        ('ğŸ›','Pest Monitoring','Warm-humid conditions favor insect pest multiplication. Check regularly for early signs.'),
      ] %}
      <div class="col-sm-6">
        <div style="background:var(--cream);border-radius:10px;padding:14px;">
          <div style="font-size:1.5rem;">{{ item[0] }}</div>
          <div style="font-weight:700;color:var(--green-dark);margin:4px 0;">{{ item[1] }}</div>
          <div style="font-size:.82rem;color:var(--text-muted);">{{ item[2] }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% elif weather.season == 'Winter' %}
    <div class="row g-3">
      {% for item in [
        ('â„ï¸','Rabi Crop Care','Cool temperature is ideal for wheat, mustard, gram. Apply fertilizers on schedule.'),
        ('ğŸ’§','Irrigation Timing','Irrigate in morning â€” avoid evening irrigation which increases frost risk at root zone.'),
        ('ğŸŒ¼','Mustard Flowering','If mustard is flowering, ensure irrigation but avoid waterlogging.'),
        ('ğŸŒ¾','Wheat Monitoring','Check wheat for yellow rust and aphid attack which peak in January-February.'),
      ] %}
      <div class="col-sm-6">
        <div style="background:var(--cream);border-radius:10px;padding:14px;">
          <div style="font-size:1.5rem;">{{ item[0] }}</div>
          <div style="font-weight:700;color:var(--green-dark);margin:4px 0;">{{ item[1] }}</div>
          <div style="font-size:.82rem;color:var(--text-muted);">{{ item[2] }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% elif weather.season == 'Summer' %}
    <div class="row g-3">
      {% for item in [
        ('â˜€ï¸','Irrigation Frequency','Increase irrigation frequency. Summer crops need 30-40% more water than winter crops.'),
        ('ğŸ’§','Evening Irrigation','Always irrigate in evening (4-7 PM) to reduce evaporation losses by 40-50%.'),
        ('ğŸ…','Summer Vegetables','Tomato, cucumber, bitter gourd respond well to summer planting with good irrigation.'),
        ('ğŸ—ï¸','Soil Preparation','Summer is ideal for deep ploughing and land preparation for kharif season.'),
      ] %}
      <div class="col-sm-6">
        <div style="background:var(--cream);border-radius:10px;padding:14px;">
          <div style="font-size:1.5rem;">{{ item[0] }}</div>
          <div style="font-weight:700;color:var(--green-dark);margin:4px 0;">{{ item[1] }}</div>
          <div style="font-size:.82rem;color:var(--text-muted);">{{ item[2] }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="row g-3">
      {% for item in [
        ('ğŸŒ¾','Harvest Season','Post-monsoon is main harvest time for kharif crops. Arrange labor and storage in advance.'),
        ('ğŸª¨','Soil Health','Good time for soil testing before rabi season. Apply lime if soil is acidic.'),
        ('ğŸŒ±','Rabi Preparation','Start land preparation for rabi crops. Deep ploughing helps break pest cycles.'),
        ('ğŸ’°','Market Watch','Monitor mandi prices for harvested kharif crops to sell at the right time.'),
      ] %}
      <div class="col-sm-6">
        <div style="background:var(--cream);border-radius:10px;padding:14px;">
          <div style="font-size:1.5rem;">{{ item[0] }}</div>
          <div style="font-weight:700;color:var(--green-dark);margin:4px 0;">{{ item[1] }}</div>
          <div style="font-size:.82rem;color:var(--text-muted);">{{ item[2] }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>

<div style="text-align:center;margin-top:16px;font-size:.75rem;color:var(--text-muted);">
  â„¹ï¸ Weather data is based on typical seasonal patterns for India. For exact local weather, check IMD (India Meteorological Department) at <strong>mausam.imd.gov.in</strong>
</div>
{% endblock %}